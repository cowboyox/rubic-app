<ng-template #connectWalletButton>
  <app-connect-wallet-button></app-connect-wallet-button>
</ng-template>

<ng-container *ngIf="user$ | async; else connectWalletButton">
  <ng-template #updateRateButton>
    <app-update-rate-button (onClick)="onUpdateRateClick.emit()"></app-update-rate-button>
  </ng-template>

  <ng-container *ngIf="(isUpdateRateStatus$ | async) === false; else updateRateButton">
    <ng-container *ngLet="error$ | async as error">
      <ng-container *ngIf="!error.text || error.loading; else errorButton">
        <ng-container *ngIf="needApprove; else swapButton">
          <app-approve-swap-button
            (onApproveClick)="onApproveClick.emit()"
            (onSwapClick)="onSwapClick.emit()"
          ></app-approve-swap-button>
        </ng-container>

        <ng-template #swapButton>
          <app-swap-button (onClick)="onSwapClick.emit()"></app-swap-button
        ></ng-template>
      </ng-container>

      <ng-template #errorButton>
        <ng-container *ngLet="isMobile$ | async as isMobile">
          <ng-container *ngLet="error.type | functionCall: allowChangeNetwork:this as allowChange">
            <!-- switch network button -->
            <ng-container *ngIf="allowChange && !isMobile">
              <app-rubic-button
                [attr.error]="true"
                appearance="secondary"
                [loading]="status === TRADE_STATUS.LOADING"
                (click)="changeNetwork()"
              >
                {{ 'common.switchTo' | translate: (fromBlockchain$ | async) }}
              </app-rubic-button>
            </ng-container>

            <!-- error info -->
            <ng-container *ngIf="!allowChange || isMobile">
              <app-rubic-button
                class="error-button"
                [attr.error]="true"
                [attr.error-min-max]="error.type | functionCall: isMinMaxError"
                appearance="secondary"
                [disabled]="true"
              >
                {{ error.text }}
              </app-rubic-button>
            </ng-container>
          </ng-container>
        </ng-container>
      </ng-template>
    </ng-container>
  </ng-container>
</ng-container>
