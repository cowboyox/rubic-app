<div class="order-book-form">
  <div class="order-book-form__main-section main-section">
    <div class="main-section__tokens-forms tokens-forms">
      <div class="tokens-forms__tokens-form tokens-form">
        <div class="tokens-form__header tokens-form-header">
          <span class="tokens-form-header__label">
            {{ 'You have' | translate }}
          </span>
        </div>

        <app-tokens-input
          [tokensList]="availableBaseTokens"
          [selectedToken]="baseToken"
          [selectedAmount]="baseAmountAsString"
          (tokenChanges)="baseToken = $any($event)"
          (numberChanges)="baseAmountAsString = $event"
        ></app-tokens-input>

        <div class="tokens-form__custom-section custom-section">
          <div class="custom-section__button-container">
            <label
              class="custom-section__button"
              for="base-custom-input"
              (click)="isCustomTokenSectionOpened.base = !isCustomTokenSectionOpened.base"
            >
              {{ isCustomTokenSectionOpened.base ? 'Cancel' : 'Use custom token' }}
            </label>
          </div>

          <div
            class="custom-section__form custom-section-form"
            *ngIf="isCustomTokenSectionOpened.base"
          >
            <input
              type="text"
              class="custom-section-form__input"
              id="base-custom-input"
              placeholder="Token contract address"
              pattern="0x[A-Fa-f0-9]{40}"
              appTokenAddress
              [blockchain]="blockchain"
              (tokenValidated)="setCustomToken('base', $event)"
              [(ngModel)]="customToken.base.address"
              #baseCustomToken="ngModel"
              [ngClass]="{
                'custom-section-form__input_invalid':
                  baseCustomToken.value && baseCustomToken.invalid
              }"
            />
            <app-primary-button
              label="Add"
              [animate]="baseCustomToken.pending"
              [disabled]="!baseCustomToken.valid"
              (click)="addCustomToken('base')"
            ></app-primary-button>
          </div>
        </div>
      </div>

      <button class="tokens-forms__revert-btn" type="button" (click)="revertTokens()">
        <img src="/assets/images/icons/revert.svg" alt="reverse tokens" />
      </button>

      <div class="tokens-forms__tokens-form tokens-form">
        <div class="tokens-form__header tokens-form-header">
          <span class="tokens-form-header__label">
            {{ 'You want to get' | translate }}
          </span>

          <div class="tokens-form-header__rate tokens-rate" *ngIf="tokensRate">
            <div class="tokens-rate__main">
              {{
                (tokensRate.abs().toFixed(2) | number) +
                  '% ' +
                  (tokensRate.isGreaterThan(0) ? 'higher' : 'lower')
              }}

              <div class="tokens-rate__info tokens-rate-info">
                <img src="/assets/images/icons/info.svg" alt="info" />

                <div class="tokens-rate-info__popup-container">
                  <div class="tokens-rate-info__popup tokens-rate-popup">
                    <span>
                      Your rate is
                      <span class="tokens-rate-popup__rate">{{
                        (tokensRate.abs().toFixed(2) | number) +
                          '% ' +
                          (tokensRate.isGreaterThan(0) ? 'higher' : 'lower')
                      }}</span>
                      than coingecko rate
                    </span>

                    <span class="tokens-rate-popup__triangle"></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <app-tokens-input
          [tokensList]="availableQuoteTokens"
          [selectedToken]="quoteToken"
          [selectedAmount]="quoteAmountAsString"
          (tokenChanges)="quoteToken = $any($event)"
          (numberChanges)="quoteAmountAsString = $event"
        ></app-tokens-input>

        <div class="tokens-form__custom-section custom-section">
          <label
            class="custom-section__button"
            for="quote-custom-input"
            (click)="isCustomTokenSectionOpened.quote = !isCustomTokenSectionOpened.quote"
          >
            {{ isCustomTokenSectionOpened.quote ? 'Cancel' : 'Use custom token' }}
          </label>

          <div
            class="custom-section__form custom-section-form"
            *ngIf="isCustomTokenSectionOpened.quote"
          >
            <input
              type="text"
              class="custom-section-form__input"
              id="quote-custom-input"
              placeholder="Token contract address"
              pattern="0x[A-Fa-f0-9]{40}"
              appTokenAddress
              [blockchain]="blockchain"
              (tokenValidated)="setCustomToken('quote', $event)"
              [(ngModel)]="customToken.quote.address"
              #quoteCustomToken="ngModel"
              [ngClass]="{
                'custom-section-form__input_invalid':
                  quoteCustomToken.value && quoteCustomToken.invalid
              }"
            />
            <app-primary-button
              label="Add"
              [animate]="quoteCustomToken.pending"
              [disabled]="!quoteCustomToken.valid"
              (click)="addCustomToken('quote')"
            ></app-primary-button>
          </div>
        </div>
      </div>
    </div>

    <div class="main-section__confirm-section confirm-section">
      <app-primary-button
        label="Create Trade"
        [disabled]="!(tradeForm.areAmountsAndTokensSet && tradeForm.areOptionsValid)"
        (click)="createTrade()"
      ></app-primary-button>
    </div>
  </div>

  <app-order-books-form-options></app-order-books-form-options>
</div>
