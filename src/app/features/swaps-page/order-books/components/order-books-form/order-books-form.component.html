<div class="order-book">
  <div class="order-book__warning" *ngIf="isAnyTokenCustom()">
    <app-warning-disclaimer
      [warningText]="'Unknown token. Please check it before trading.'"
      [tooltipText]="'tradesFrom.unknownTokenWarning' | translate"
    ></app-warning-disclaimer>
  </div>

  <form class="order-book-form">
    <div class="order-book-form__main-section main-section">
      <div class="main-section__from-section">
        <div class="main-section__tokens-form tokens-form">
          <div class="tokens-form__header tokens-form-header">
            <span class="tokens-form-header__label">
              {{ 'common.have' | translate }}
            </span>
          </div>

          <app-tokens-input
            [tokensList]="availableBaseTokens"
            [selectedToken]="baseToken"
            [selectedAmount]="baseAmount"
            (tokenChanges)="baseToken = $any($event)"
            (numberChanges)="baseAmount = $event"
          ></app-tokens-input>

          <div class="tokens-form__custom-token-section">
            <app-custom-token-form
              type="from"
              [isSectionOpened]="tradeParameters?.isCustomFromTokenFormOpened"
              (isSectionOpenedChange)="setIsCustomTokenFormOpened('base', $event)"
              [blockchain]="blockchain"
              [tokenAddress]="tradeParameters?.customFromTokenAddress"
              (tokenAddressChange)="setCustomTokenAddress('base', $event)"
              (tokenIsValidated)="updateCustomToken('base', $event)"
              (addToken)="addCustomToken('base')"
            ></app-custom-token-form>
          </div>
        </div>
      </div>

      <div class="main-section__arrow-section" (click)="revertTokens()">
        <button type="button" class="arrow-button">
          <img src="assets/images/icons/revert.svg" alt="" />
        </button>
      </div>

      <div class="main-section__to-section to-section">
        <div class="main-section__tokens-form tokens-form">
          <div class="tokens-form__header tokens-form-header">
            <span class="tokens-form-header__label">
              {{ 'common.want' | translate }}
            </span>

            <div class="tokens-form-header__rate tokens-rate" *ngIf="tokensRate">
              <div class="tokens-rate__main">
                {{
                  (tokensRate.abs().toFixed(2) | number) +
                    '% ' +
                    (tokensRate.isGreaterThan(0)
                      ? ('orderBook.higher' | translate)
                      : ('orderBook.lower' | translate))
                }}

                <div class="tokens-rate__info tokens-rate-info">
                  <img
                    src="/assets/images/icons/info.svg"
                    [matTooltip]="
                      ('orderBook.yourRate' | translate) +
                      (tokensRate.abs().toFixed(2) | number) +
                      '% ' +
                      (tokensRate.isGreaterThan(0) ? 'higher' : 'lower') +
                      ('orderBook.coingeckoRate' | translate)
                    "
                    [alt]="
                      ('orderBook.yourRate' | translate) +
                      (tokensRate.abs().toFixed(2) | number) +
                      '% ' +
                      (tokensRate.isGreaterThan(0) ? 'higher' : 'lower') +
                      ('orderBook.coingeckoRate' | translate)
                    "
                  />
                </div>
              </div>
            </div>
          </div>

          <app-tokens-input
            [tokensList]="availableQuoteTokens"
            [selectedToken]="quoteToken"
            [selectedAmount]="quoteAmount"
            (tokenChanges)="quoteToken = $any($event)"
            (numberChanges)="quoteAmount = $event"
          ></app-tokens-input>

          <div class="tokens-form__custom-token-section">
            <app-custom-token-form
              type="to"
              [isSectionOpened]="tradeParameters?.isCustomToTokenFormOpened"
              (isSectionOpenedChange)="setIsCustomTokenFormOpened('quote', $event)"
              [blockchain]="blockchain"
              [tokenAddress]="tradeParameters?.customToTokenAddress"
              (tokenAddressChange)="setCustomTokenAddress('quote', $event)"
              (tokenIsValidated)="updateCustomToken('quote', $event)"
              (addToken)="addCustomToken('quote')"
            ></app-custom-token-form>
          </div>
        </div>

        <div class="to-section__confirm-section confirm-section">
          <app-primary-button
            label="Create Trade"
            [animate]="
              selectedTradeState === TRADE_STATUS.STARTED ||
              selectedTradeState === TRADE_STATUS.TX_IN_PROGRESS
            "
            [disabled]="!(tradeForm.areAmountsAndTokensSet && tradeForm.areOptionsValid)"
            (click)="createTrade()"
          ></app-primary-button>
        </div>
      </div>
    </div>

    <app-order-books-form-options></app-order-books-form-options>
  </form>
</div>

<app-trade-in-progress-modal *ngIf="selectedTradeState === TRADE_STATUS.TX_IN_PROGRESS">
</app-trade-in-progress-modal>

<app-trade-success-modal
  *ngIf="selectedTradeState === TRADE_STATUS.COMPLETED"
  [transactionId]="transactionHash"
  [blockchainName]="blockchain"
  (onClose)="navigateToTrade()"
>
</app-trade-success-modal>
