<div class="index-start-form__wrapper">
  <div class="start-form-menus">
    <ul class="block-tabs block-tabs_blockchains">
      <li class="block-tabs_item"
          (click)="setNetwork(1)" [ngClass]="{active: requestData.network === 1}">
        <img class="block-tabs_item_icon" src="./assets/images/icons/coins/eth.png"/>
        <span class="block-tabs_item_text">Ethereum</span>
      </li>
      <li class="block-tabs_item"
          (click)="setNetwork(22)" [ngClass]="{active: requestData.network === 22}">
        <img class="block-tabs_item_icon" src="./assets/images/icons/coins/bnb.svg"/>
        <span class="block-tabs_item_text">Binance Smart Chain</span>
      </li>
      <li class="block-tabs_item"
          (click)="setNetwork(24)" [ngClass]="{active: requestData.network === 24}">
        <img class="block-tabs_item_icon" src="./assets/images/icons/coins/matic.svg"/>
        <span class="block-tabs_item_text">Matic</span>
      </li>
    </ul>

    <ul class="block-tabs block-tabs_order-type">
      <li class="block-tabs_item" [ngClass]="{active: instanceTrade, hidden: requestData.network !== 1}"
          (click)="activateInstanceTrade()">
        <span class="block-tabs_item_text">
          {{'Instant Trades' | translate }}
        </span>
        <span class="block-tabs_item_ico">
          <svg width="12" height="21" viewBox="0 0 12 21" xmlns="http://www.w3.org/2000/svg">
            <path d="M11.8835 9.50781L6.83827 8.19567C6.75249 8.15662 6.70571 8.05507 6.7291 7.96134L8.9125 0.251608C8.96708 0.0485147 8.70975 -0.0920883 8.56939 0.0719485L0.0463406 11.1875C-0.0394358 11.2891 -0.000446528 11.4375 0.116521 11.4922L5.16173 12.8043C5.24751 12.8434 5.29429 12.9449 5.2709 13.0387L3.0875 20.7484C3.03292 20.9515 3.29025 21.0921 3.43061 20.9281L11.9537 9.81245C12.0394 9.71871 12.0004 9.56249 11.8835 9.50781Z"/>
          </svg>
        </span>
      </li>
      <li class="block-tabs_item" [ngClass]="{active: !instanceTrade}"
          (click)="deActivateInstanceTrade()">
        <span class="block-tabs_item_text">
          {{'Order Book' | translate }}
        </span>
        <span class="block-tabs_item_ico">
          <svg width="14" height="16" viewBox="0 0 14 16" xmlns="http://www.w3.org/2000/svg">
            <path d="M2.11889 12.7728H13.4535C13.4883 12.7728 13.5219 12.768 13.5542 12.7606C13.5568 12.7606 13.5589 12.761 13.5615 12.761C13.8034 12.761 14 12.5722 14 12.3394V0.421667C14 0.188905 13.8034 0 13.5615 0H13.4544H2.82026H2.11951C0.952258 0 0.00280719 0.913141 0.00280719 2.03518C0.00280719 2.05023 0.00588649 2.06451 0.00740805 2.07904C0.00588649 3.11553 -0.00748146 12.6396 0.0058865 13.8916C0.00505327 13.9161 0.00193766 13.94 0.00193766 13.9647C0.00193766 15.0436 0.880528 15.9269 1.98565 15.9936C2.00782 15.9969 2.02956 16 2.05256 16H13.5614C13.8034 16 14 15.8112 14 15.5783V13.9911C14 13.7584 13.8034 13.5695 13.5614 13.5695C13.3195 13.5695 13.1229 13.7585 13.1229 13.9911V15.1567H2.11889C1.45249 15.1567 0.908495 14.6479 0.88176 14.0136C0.882412 14.0022 0.884549 13.9915 0.884332 13.98C0.883897 13.9615 0.883245 13.9327 0.88281 13.8943C0.921139 13.27 1.4601 12.7728 2.11889 12.7728ZM2.41792 2.03518C2.41792 1.80242 2.61438 1.61352 2.85645 1.61352C3.09852 1.61352 3.29498 1.80242 3.29498 2.03518V10.6004C3.29498 10.833 3.09852 11.022 2.85645 11.022C2.61438 11.022 2.41792 10.833 2.41792 10.6004V2.03518Z"/>
          </svg>
        </span>
      </li>
    </ul>

  </div>



  <form
    #startForm="ngForm"
    class="index-start-form"
    (submit)="createContract()"
  >
    <div class="grid-row">
      <div class="grid-cell grid-cell-3-8 grid-cell-sma-1-2 grid-cell-ps-1">
        <div class="form-field index-start-form__all-input">
          <label class="form-field_label">{{'You have' | translate}}</label>
          <div class="form-field_input">
            <input
              type="hidden"
              required
              [ngModel]="requestData.tokens_info.base.token.address"
              name="base_address"
            />
            <input
              type="hidden"
              required
              [ngModel]="requestData.tokens_info.base.amount"
              name="base_limit"
            />
            <app-tokens-all-input
              [otherTokens]="instanceTrade ? instanceTradesTokens : false"
              (TokenChange)="changedToken()"
              [blockchain]="blockchainsOfNetworks[requestData.network]"
              [setToken]="BaseTokenCustom"
              [resetForm]="resetFormEmitter"
              [tokenModel]="requestData.tokens_info.base"
            ></app-tokens-all-input>
          </div>
          <div
            class="form-field_description normal-font text-right form-field_description-show"
            [ngStyle]="{visibility: instanceTrade ? 'hidden' : 'visible'}"
          >
            <span (click)="openedCustomTokens.base = !openedCustomTokens.base">
              {{(openedCustomTokens.base ? 'Cancel' : 'Use custom token') | translate}}
            </span>
            <div
              *ngIf="openedCustomTokens.base"
              class="index-start-form__choose-token"
            >
              <div class="form-field_input">
                <input
                  type="text"
                  [placeholder]="'Token Contract Address' | translate"
                  appEthTokenValidator
                  class="min-text"
                  required
                  pattern="0x[0-9a-fA-F]{40}"
                  #baseCustomToken="ngModel"
                  autocomplete="on"
                  [ngModelOptions]="{ standalone: true }"
                  (TokenResolve)="setCustomToken('base', $event)"
                  [network]="requestData.network"
                  [(ngModel)]="customTokens.base.address"
                />
              </div>
              <div class="form-field_input index-start-form__choose-token__btn">
                <button
                  class="btn btn-green btn-min btn-for-field width-100"
                  type="button"
                  [disabled]="!baseCustomToken.valid"
                  (click)="addCustomToken('base')"
                  style="height: 100%"
                >
                  <img
                    class="arrow"
                    src="./assets/images/buttons/arrow_w.svg"
                  />
                  <span>{{'Add' | translate}}</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="grid-cell grid-cell-3-8 grid-cell-sma-1-2 grid-cell-ps-1">
        <div class="form-field">
          <label class="form-field_label" *ngIf="!instanceTrade">{{'You want to get' | translate}}</label>
          <label class="form-field_label" *ngIf="instanceTrade">{{'You get' | translate}}</label>
          <div class="form-field_input">
            <input
              type="hidden"
              required
              [ngModel]="requestData.tokens_info.quote.token.address"
              name="quote_address"
            />
            <input
              type="hidden"
              required
              [ngModel]="requestData.tokens_info.quote.amount"
              name="quote_limit"
            />

            <app-tokens-all-input
                    [otherTokens]="instanceTrade ? instanceTradesTokens : false"
                    [disabled]="instanceTrade"
                    (TokenChange)="changedToken()"
                    [blockchain]="blockchainsOfNetworks[requestData.network]"
                    [setToken]="QuoteTokenCustom"
                    [resetForm]="resetFormEmitter"
                    [amountPlaceholder]="!instanceTrade"
                    [tokenModel]="requestData.tokens_info.quote"
            ></app-tokens-all-input>

            <label class="form-field_label form-field_label--rate"
                   *ngIf="!instanceTrade && cmcRate && cmcRate.isMessage && cmcRate.change">
              <div class="form-field_label--rate-short">
                <span class="form-field_label--rate-short-txt">
                  {{ cmcRate.change }}% {{ cmcRate.isLower ? 'lower' : 'higher' }}
                </span>
                <div class="form-field_label--rate-short-icon">
                  <img src="./assets/images/icons/info.svg">

                  <div class="form-notice">
                    <div class="form-notice_content">
                      <div class="form-notice_text form-field_label--rate_text">
                        {{'Your rate is' | translate}}
                        <b
                        ><span class="green-text">{{ cmcRate.change }}%</span>
                          <span class="green-text">
                      {{ cmcRate.isLower ? 'lower' : 'higher' }}</span
                          >
                        </b>
                        {{'than' | translate}}
                        <a href="https://coinmarketcap.com/" target="_blank"
                        >{{'coinmarketcap' | translate}}</a
                        >
                        {{'rate.' | translate}}
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </label>

          </div>




          <div
            class="form-field_description normal-font text-right form-field_description-show"
            [ngStyle]="{visibility: instanceTrade ? 'hidden' : 'visible'}"
          >
            <span
              (click)="openedCustomTokens.quote = !openedCustomTokens.quote"
              >{{
              (openedCustomTokens.quote ? 'Cancel' : 'Use custom token') | translate
              }}</span
            >
            <div
              *ngIf="openedCustomTokens.quote"
              class="index-start-form__choose-token"
            >
              <div class="form-field_input">
                <input
                  [placeholder]="'Token Contract Address' | translate"
                  type="text"
                  appEthTokenValidator
                  class="min-text"
                  [ngModelOptions]="{ standalone: true }"
                  #quoteCustomToken="ngModel"
                  [network]="requestData.network"
                  (TokenResolve)="setCustomToken('quote', $event)"
                  [(ngModel)]="customTokens.quote.address"
                />
              </div>
              <div class="form-field_input">
                <button
                  class="btn btn-green btn-min btn-for-field width-100"
                  type="button"
                  [disabled]="!quoteCustomToken.valid"
                  (click)="addCustomToken('quote')"
                  style="height: 100%"
                >
                  <img
                    class="arrow"
                    src="./assets/images/buttons/arrow_w.svg"
                  />
                  <span>{{'Add' | translate}}</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="grid-cell grid-cell-1-4 grid-cell-sma-1-2 grid-cell-ps-1"
        style="float: right"
      >
        <label class="form-field_label">&nbsp;</label>
        <div class="form-field form-field_btn form-field_btn--rate">
          <button
            class="btn btn-green width-100"
            [disabled]="
              getInstanceQuoteProgress ||
              !requestData.tokens_info.base.amount ||
              !requestData.tokens_info.quote.amount ||
              !requestData.tokens_info.base.token.address ||
              !requestData.tokens_info.quote.token.address ||
              isCreatingContract ||
              (requestData.broker_fee && !requestData.broker_fee_address) ||
              (requestData.broker_fee &&
                !(
                  requestData.broker_fee_quote <= 50 &&
                  requestData.broker_fee_quote >= 0
                )) ||
              (requestData.broker_fee &&
                !(
                  requestData.broker_fee_base <= 50 &&
                  requestData.broker_fee_base >= 0
                )) ||
              (requestData.tokens_info.base.token.address.toLowerCase() === requestData.tokens_info.quote.token.address.toLowerCase())
            "
          >
            <span class="lds-ellipsis" *ngIf="getInstanceQuoteProgress || isCreatingContract">
              <span class="lds-ellipsis-container">
                <span></span><span></span><span></span><span></span>
              </span>
            </span>
            <span>
              {{ (isCreatingContract ? 'Creating Trade' : 'Create Trade') | translate }}
            </span>
          </button>
        </div>
        <div class="form-field_description normal-font normal-font--visible text-right">
          <span
                  [hidden]="instanceTrade"
                  class="underline-link underline-link_btn"
                  (click)="toogleAdvSettings()">
            {{(isAdvSettingsOpen ? 'Close Settings' : 'Advanced Settings') | translate}}
          </span>
        </div>
      </div>
    </div>
  </form>
  <form
    class="index-start-form__settings"
    [ngClass]="{ hidden: !isAdvSettingsOpen || instanceTrade}"
    #advSettings="ngForm"
  >
    <div class="index-start-form__settings-block">
      <div class="index-start-form__settings-block-wrapper">
        <div class="index-start-form__settings-item">
          <div class="index-start-form__settings-item-head">{{'closing date' | translate}}</div>
          <div class="index-start-form__settings-item-content">
            <input
              matInput
              [matDatepicker]="datepicker"
              required
              readonly
              [(ngModel)]="datePickerDate"
              (dateChange)="dateChange()"
              [min]="minDate"
              name="active_to"
              (click)="datepicker.open()"
              placeholder="Choose a date"
              class="min-text index-start-form__settings-item-date"
            />

            <mat-datepicker #datepicker></mat-datepicker>
          </div>
        </div>
        <div class="index-start-form__settings-item">
          <div class="index-start-form__settings-item-head">{{'closing time' | translate}}</div>
          <div class="index-start-form__settings-item-content">
            <input
              [ngxTimepicker]="picker"
              [format]="24"
              [min]="minTime"
              required
              readonly
              (ngModelChange)="timeChange()"
              [(ngModel)]="datePickerTime"
              name="time"
              class="min-text index-start-form__settings-item-time"
              placeholder="Choose a time"
            />
            <ngx-material-timepicker #picker></ngx-material-timepicker>
          </div>
        </div>
        <div class="index-start-form__settings-item">
          <div class="index-start-form__settings-item-head">{{'Public deal' | translate}}</div>
          <div
            class="index-start-form__settings-item-content"
            (click)="changePD()"
          >
            <label class="form-field_input-checkbox" style="min-width: 70px">
              <input
                type="checkbox"
                name="public"
                [(ngModel)]="requestData.public"
                [value]="requestData.public"
              />
              <span class="checkbox-text checkbox-text_on">{{'Yes' | translate}}</span>
              <span class="checkbox-text checkbox-text_off">{{'No' | translate}}</span>
              <span class="checkbox-rect"></span>
            </label>
            <span>{{'Trade will be listed on the main page' | translate}}</span>
          </div>
        </div>
      </div>
    </div>
    <div
      class="index-start-form__settings-block"
      *ngIf="
        requestData.tokens_info.base.token.token_name &&
        requestData.tokens_info.quote.token.token_name
      "
    >
      <div class="index-start-form__settings-item">
        <div class="index-start-form__settings-item-head">{{'Permanent trade' | translate}}</div>
        <div
          class="index-start-form__settings-item-content"
          style="position: relative"
        >
          <div
            class="input-content-disabled"
            style="
              position: absolute;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              z-index: 2;
            "
          ></div>
          <label class="form-field_input-checkbox" style="min-width: 70px">
            <input
              type="checkbox"
              name="permanent"
              [(ngModel)]="requestData.permanent"
              disabled="true"
            />
            <span class="checkbox-text checkbox-text_on">{{'Yes' | translate}}</span>
            <span class="checkbox-text checkbox-text_off">{{'No' | translate}}</span>
            <span class="checkbox-rect"></span>
          </label>
          <span>
            {{'Lock liquidity until the trade completion' | translate}}
          </span>
        </div>
      </div>
      <div class="index-start-form__settings-item-wrapper">
        <div class="form-field">
          <label class="index-start-form__settings-item-head"
            >{{'Minimum contribution in' | translate}}
            {{ requestData.tokens_info.base.token.token_name }} ({{
              requestData.tokens_info.base.token.token_short_name
            }})</label
          >
          <div class="form-field_input">
            <input
              type="text"
              placeholder="0"
              name="min_base_wei"
              [(ngModel)]="requestData.min_base_wei"
              [appBigNumber]="{
                decimals: 8,
                min: 0,
                max: requestData.tokens_info.base.amount
              }"
            />
          </div>
        </div>
        <div class="form-field">
          <label class="index-start-form__settings-item-head"
            >{{'Minimum contribution in' | translate}}
            {{ requestData.tokens_info.quote.token.token_name }} ({{
              requestData.tokens_info.quote.token.token_short_name
            }})</label
          >
          <div class="form-field_input">
            <input
              type="text"
              placeholder="0"
              name="min_quote_wei"
              [(ngModel)]="requestData.min_quote_wei"
              [appBigNumber]="{
                decimals: 8,
                min: 0,
                max: requestData.tokens_info.quote.amount
              }"
            />
          </div>
        </div>
      </div>
    </div>
    <div
      class="index-start-form__settings-block"
      *ngIf="
        requestData.tokens_info.base.token.token_name &&
        requestData.tokens_info.quote.token.token_name
      "
    >
      <div
        class="index-start-form__settings-item-checkbox"
        *ngIf="
          requestData.tokens_info.base.amount &&
          requestData.tokens_info.quote.amount
        "
      >
        <div class="index-start-form__settings-item-checkbox-head">
          <div class="index-start-form__settings-item">
            <div class="index-start-form__settings-item-head">
              {{'Brokerage fee' | translate}}
            </div>
            <div class="index-start-form__settings-item-content">
              <label class="form-field_input-checkbox" style="min-width: 70px">
                <input
                  type="checkbox"
                  name="broker_fee"
                  [(ngModel)]="requestData.broker_fee"
                />
                <span class="checkbox-text checkbox-text_on">{{'Yes' | translate}}</span>
                <span class="checkbox-text checkbox-text_off">{{'No' | translate}}</span>
                <span class="checkbox-rect"></span>
              </label>
              <span>{{'You can specify % for Broker' | translate}}</span>
            </div>
          </div>
        </div>
        <div
          class="index-start-form__settings-item-checkbox-input"
          *ngIf="requestData.broker_fee"
        >
          <div class="form-field">
            <label class="index-start-form__settings-item-head uppercase"
              >{{'Enter Broker Address' | translate}}</label
            >
            <div class="form-field_input">
              <input
                maxlength="42"
                type="text"
                placeholder="0xD0593B233Be4411A236F22b42087345E1137170b"
                name="broker_fee_address"
                [(ngModel)]="requestData.broker_fee_address"
                [pattern]="'0x[0-9a-fA-F]{40}'"
              />
            </div>
          </div>
        </div>
        <div
          class="index-start-form__settings-item-checkbox-percent"
          *ngIf="requestData.broker_fee"
        >
          <div class="form-field">
            <label class="index-start-form__settings-item-head"
              >{{'Specify % for' | translate}}
              {{ requestData.tokens_info.base.token.token_name }} ({{
                requestData.tokens_info.base.token.token_short_name
              }})</label
            >
            <div class="form-field_input">
              <input
                placeholder="0.1"
                [(ngModel)]="requestData.broker_fee_base"
                name="broker_fee_base"
                min="0"
                max="50"
                appMinValue
                [minValue]="0"
                value="0.1"
                [step]="0.01"
                [maxValue]="50"
                type="number"
              />
              <span>%</span>
            </div>
            <span
              *ngIf="
                requestData.broker_fee_base >= 0 &&
                requestData.broker_fee_base <= 50
              "
            >
              {{ baseBrokerFee | number: '1.0-8' }}
              {{ requestData.tokens_info.base.token.token_short_name }}</span
            >
          </div>
          <div class="form-field">
            <label class="index-start-form__settings-item-head"
              >{{'Specify % for' | translate}}
              {{ requestData.tokens_info.quote.token.token_name }} ({{
                requestData.tokens_info.quote.token.token_short_name
              }})</label
            >
            <div class="form-field_input">
              <input
                placeholder="0.1"
                [(ngModel)]="requestData.broker_fee_quote"
                name="broker_fee_quote"
                min="0"
                max="50"
                value="0.1"
                appMinValue
                [minValue]="0"
                [step]="0.01"
                [maxValue]="50"
                type="number"
              />
              <span>%</span>
            </div>
            <span
              *ngIf="
                requestData.broker_fee_quote >= 0 &&
                requestData.broker_fee_quote <= 50
              "
            >
              {{ quoteBrokerFee | number: '1.0-8' }}
              {{ requestData.tokens_info.quote.token.token_short_name }}</span
            >
          </div>
        </div>
      </div>
    </div>
  </form>
</div>

<ng-template #metaMaskError>
  <div class="dialog-block">
    <div class="dialog-block__content">
      <button
        class="dialog-closer"
        (click)="closeMetaMaskError()"
        type="button"
      >
        <img src="./assets/images/icons/cross-blue.svg" />
      </button>

      <div class="transaction-title">{{'Error' | translate}}</div>

      <div class="transaction-description">
        {{'Please choose main net network in Metamask.' | translate}}
      </div>

      <div class="alert-window-buttons text-center">
        <button
          class="btn btn-green btn-auto btn-min"
          (click)="closeMetaMaskError()"
          type="button"
        >
          <span>&nbsp;&nbsp;&nbsp;{{'Close' | translate}}&nbsp;&nbsp;&nbsp;</span>
        </button>
      </div>
    </div>
  </div>
</ng-template>
